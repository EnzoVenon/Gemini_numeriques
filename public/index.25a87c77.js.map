{"mappings":"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","sources":["src/js/jsItown/plugins/FeatureToolTip2.js"],"sourcesContent":["// const { GeometryLayer } = require(\"itowns\");\n\n/**\n * A tooltip that can display some useful information about a feature when\n * hovering it.\n *\n * @module FeatureToolTip\n *\n * @example\n * // Initialize the FeatureToolTip\n * FeatureToolTip.init(viewerDiv, view);\n *\n * // Add layers\n * var wfsSource = new itowns.WFSSource(...);\n * var wfsLayer = new itowns.ColorLayer('id_wfs', { source: wfsSource });\n * view.addLayer(wfsLayer);\n *\n * var fileSource = new itowns.FileSource(...);\n * var fileLayer = new itowns.GeometryLayer('id_myFile', new THREE.Group(), { source: fileSource });\n * view.addLayer(fileLayer);\n *\n * FeatureToolTip.addLayer(wfsLayer);\n * FeatureToolTip.addLayer(fileLayer);\n */\nvar FeatureToolTip = (function _() {\n    var tooltip;\n    var view;\n    var layers = [];\n    var layersId = [];\n\n    var mouseevent;\n\n    var mouseDown = 0;\n    document.body.addEventListener('mousedown', function _() {\n        ++mouseDown;\n    }, false);\n\n    document.body.addEventListener('mouseup', function _(event) {\n        if (event.target.id === \"\") {\n            --mouseDown;\n        }\n    }, false);\n\n    function moveToolTip(event) {\n        tooltip.innerHTML = '';\n        tooltip.style.display = 'none';\n        var features = view.pickFeaturesAt.apply(view, [event, 2].concat(layersId));\n        var layer;\n\n        for (var layerId in features) {\n            if (features[layerId].length == 0) {\n                continue;\n            }\n\n            layer = layers[layersId.indexOf(layerId)];\n            if (!layer) {\n                continue;\n            }\n            if (typeof layer.options.filterGeometries == 'function') {\n                features[layerId] = layer.options.filterGeometries(features[layerId], layer.layer) || [];\n            }\n            tooltip.innerHTML += fillToolTip(features[layerId], layer.layer);\n        }\n        tooltip.innerHTML = \"\";\n\n        if (tooltip.innerHTML != '') {\n            tooltip.style.display = 'block';\n            tooltip.style.left = view.eventToViewCoords(event).x + 'px';\n            tooltip.style.top = view.eventToViewCoords(event).y + 'px';\n        }\n\n    }\n\n    function getGeometryProperties(geometry) {\n        return function properties() {\n            return geometry.properties;\n        };\n    }\n\n\n    function fillToolTip(features, layer) {\n        var content = '';\n\n        var feature;\n        var geometry;\n        var style;\n\n        for (var p = 0; p < features.length; p++) {\n            feature = features[p];\n            geometry = feature.geometry;\n\n            tooltip.value = geometry\n\n            style = (geometry.properties && geometry.properties.style) || feature.style || layer.style;\n            var context = { globals: {}, properties: getGeometryProperties(geometry) };\n            style = style.drawingStylefromContext(context);\n\n            content = ''\n        }\n\n\n        return content;\n    }\n\n    return {\n        /**\n         * Initialize the `FeatureToolTip` plugin for a specific view.\n         *\n         * @param {Element} viewerDiv - The element containing the viewer.\n         * @param {View} viewer - The view to bind the tooltip to.\n         *\n         * @example\n         * const viewerDiv = document.getElementById('viewerDiv');\n         * const view = new GlobeView(viewerDiv, { longitude: 4, latitude: 45, altitude: 3000 });\n         *\n         * FeatureToolTip.init(viewerDiv, view);\n         *\n         * @memberof module:FeatureToolTip\n         */\n        init: function _(viewerDiv, viewer) {\n            // HTML element\n            tooltip = document.createElement('div');\n            tooltip.className = 'tooltip';\n            tooltip.id = 'tooltip';\n\n            mouseevent = document.createElement('div');\n            mouseevent.className = 'mouseevent';\n            mouseevent.id = 'mouseevent';\n\n\n            viewerDiv.appendChild(tooltip);\n            viewerDiv.appendChild(mouseevent);\n\n\n            // View binding\n            view = viewer;\n\n            // Mouse movement listening\n            function onMouseMove(event) {\n                if (mouseDown) {\n                    moveToolTip(event);\n\n                    mouseevent.value = event;\n\n\n                    tooltip.innerHTML = '<div class=\"wrapper\"><div class=\"tabs\">' + tooltip.innerHTML + '</div></div>';\n\n                    tooltip.addEventListener('mouseover', () => {\n                        document.removeEventListener('mousedown', onMouseMove);\n                    })\n                    tooltip.addEventListener('mouseout', () => {\n                        document.addEventListener('mousedown', onMouseMove);\n                    })\n\n                    tooltip.addEventListener\n                } else {\n                    tooltip.style.left = (view.eventToViewCoords(event).x) + 'px';\n                    tooltip.style.bottom = (view.eventToViewCoords(event).y) + 'px';\n                }\n            }\n\n            document.addEventListener('mousedown', onMouseMove, false);\n        },\n\n        /**\n         * Add a layer to be picked by the tooltip.\n         *\n         * @param {Layer} layer - The layer to add.\n         * @param {Object} options - Options to have more custom content displayed.\n         * @param {function} [options.filterGeometries] - A callback to filter\n         * geometries following a criteria, like an id found on FeatureGeometry\n         * properties.  This is useful to remove duplicates, for example when a\n         * feature is present on multiple tiles at the same time (see the\n         * example below).  This function takes two parameters: a list of\n         * features (usually a `Array<Feature>`) and the `Layer` associated to\n         * these features.\n         * @param {function} [options.format] - A function that takes the name\n         * of the property currently being processed and its value, and gives\n         * the appropriate HTML output to it. If this method is specified, no\n         * others properties other than the ones handled in it will be\n         * displayed.\n         * @param {Array<string>} [options.filterProperties] - An array of\n         * properties to filter.\n         * @param {boolean} [options.filterAllProperties=true] - Filter all the\n         * properties, and don't display anything besides the name of the layer\n         * the feature is attached to.\n         *\n         * @return {Layer} The added layer.\n         *\n         * @example\n         * FeatureToolTip.addLayer(wfsLayer, {\n         *      filterProperties: ['uuid', 'notes', 'classification'],\n         *      filterGeometries: (features, layer) => {\n         *          const idList = [];\n         *          return features.filter((f) => {\n         *              if (!idList.includes(f.geometry.properties.id)) {\n         *                  idList.push(f.geometry.properties.id);\n         *                  return f;\n         *              }\n         *          });\n         *      }\n         * });\n         *\n         * @memberof module:FeatureToolTip\n         */\n        addLayer: function _(layer, options) {\n            if (!layer.isLayer) {\n                return layer;\n            }\n            var opts = options || { filterAllProperties: true };\n            opts.filterProperties = opts.filterProperties == undefined ? [] : opts.filterProperties;\n            opts.filterProperties.concat(['name', 'nom', 'style', 'description']);\n\n            layers.push({ layer: layer, options: opts });\n            layersId.push(layer.id);\n\n            return layer;\n        },\n    };\n}());\n\nif (typeof module != 'undefined' && module.exports) {\n    module.exports = FeatureToolTip;\n}"],"names":["FeatureToolTip","tooltip","view","mouseevent","layers","layersId","mouseDown","getGeometryProperties","geometry","properties","fillToolTip","features","layer","feature","style","content","p","length","value","context","globals","drawingStylefromContext","document","body","addEventListener","event","target","id","init","viewerDiv","viewer","createElement","className","appendChild","onMouseMove","innerHTML","display","pickFeaturesAt","apply","concat","layerId","indexOf","options","filterGeometries","left","eventToViewCoords","x","top","y","moveToolTip","removeEventListener","bottom","addLayer","isLayer","opts","filterAllProperties","filterProperties","undefined","push","module","exports"],"version":3,"file":"index.25a87c77.js.map"}