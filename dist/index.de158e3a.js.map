{"mappings":"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","sources":["src/main.js"],"sourcesContent":["// https://github.com/iTowns/itowns/blob/master/examples/source_stream_wfs_3d.html\n\n// Define crs projection that we will use (taken from https://epsg.io/3946, Proj4js section)\nitowns.proj4.defs('EPSG:3946', '+proj=lcc +lat_1=45.25 +lat_2=46.75 +lat_0=46 +lon_0=3 +x_0=1700000 +y_0=5200000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs');\n// # Simple Globe viewer\n\n// Define initial camera position\nvar positionOnGlobe = { longitude: 4.818, latitude: 45.7354, altitude: 3000 };\nvar placement = {\n    coord: new itowns.Coordinates('EPSG:4326', 4.818, 45.7354),\n    range: 3000,\n    tilt: 45,\n}\nvar meshes = [];\nvar linesBus = [];\nvar scaler;\n\n// `viewerDiv` will contain iTowns' rendering area (`<canvas>`)\nvar viewerDiv = document.getElementById('viewerDiv');\n\n// Instanciate iTowns GlobeView*\nvar view = new itowns.GlobeView(viewerDiv, placement);\nsetupLoadingScreen(viewerDiv, view);\n\n// Add one imagery layer to the scene\n// This layer is defined in a json file but it could be defined as a plain js\n// object. See Layer* for more info.\nitowns.Fetcher.json('./layers/JSONLayers/Ortho.json').then(function _(config) {\n    config.source = new itowns.WMTSSource(config.source);\n    var layer = new itowns.ColorLayer('Ortho', config);\n    view.addLayer(layer).then(menuGlobe.addLayerGUI.bind(menuGlobe));\n});\n\n// Add two elevation layers.\n// These will deform iTowns globe geometry to represent terrain elevation.\nfunction addElevationLayerFromConfig(config) {\n    config.source = new itowns.WMTSSource(config.source);\n    var layer = new itowns.ElevationLayer(config.id, config);\n    view.addLayer(layer).then(menuGlobe.addLayerGUI.bind(menuGlobe));\n}\nitowns.Fetcher.json('./layers/JSONLayers/WORLD_DTM.json').then(addElevationLayerFromConfig);\nitowns.Fetcher.json('./layers/JSONLayers/IGN_MNT_HIGHRES.json').then(addElevationLayerFromConfig);\n\nvar color = new itowns.THREE.Color();\nvar tile;\nfunction altitudeLine(properties, contour) {\n    var result;\n    var z = 0;\n    if (contour) {\n        result = itowns.DEMUtils.getTerrainObjectAt(view.tileLayer, contour, 0, tile);\n        if (!result) {\n            result = itowns.DEMUtils.getTerrainObjectAt(view.tileLayer, contour, 0);\n        }\n        tile = [result.tile];\n        if (result) {\n            z = result.coord.z;\n        }\n        return z + 5;\n    }\n}\n\nfunction colorLine(properties) {\n    return color.set(Math.round(Math.random() * 0xffffff));\n}\n\nfunction acceptFeatureBus(properties) {\n    if (properties.sens == 'Aller') {\n        var line = properties.ligne;\n        if (linesBus.indexOf(line) === -1) {\n            linesBus.push(line);\n            return true;\n        }\n    }\n    return false;\n}\n\nvar lyonTclBusSource = new itowns.WFSSource({\n    protocol: 'wfs',\n    url: 'https://download.data.grandlyon.com/wfs/rdata?',\n    version: '2.0.0',\n    typeName: 'tcl_sytral.tcllignebus',\n    crs: 'EPSG:3946',\n    extent: {\n        west: 1822174.60,\n        east: 1868247.07,\n        south: 5138876.75,\n        north: 5205890.19,\n    },\n    format: 'geojson',\n});\n\nvar lyonTclBusLayer = new itowns.FeatureGeometryLayer('WFS Bus lines', {\n    name: 'lyon_tcl_bus',\n    filter: acceptFeatureBus,\n    source: lyonTclBusSource,\n    zoom: { min: 9 },\n\n    style: new itowns.Style({\n        stroke: {\n            color: colorLine,\n            base_altitude: altitudeLine,\n            width: 5,\n        }\n    })\n});\nview.addLayer(lyonTclBusLayer);\n\nfunction colorBuildings(properties) {\n    if (properties.usage_1 === 'RÃ©sidentiel') {\n        return color.set(0xFDFDFF);\n    } else if (properties.usage_1 === 'Annexe') {\n        return color.set(0xC6C5B9);\n    } else if (properties.usage_1 === 'Commercial et services') {\n        return color.set(0x62929E);\n    } else if (properties.usage_1 === 'Religieux') {\n        return color.set(0x393D3F);\n    } else if (properties.usage_1 === 'Sportif') {\n        return color.set(0x546A7B);\n    }\n\n    return color.set(0x555555);\n}\n\nfunction altitudeBuildings(properties) {\n    return properties.altitude_minimale_sol;\n}\n\nfunction extrudeBuildings(properties) {\n    return properties.hauteur;\n}\n\nfunction acceptFeature(properties) {\n    return !!properties.hauteur;\n}\n\nscaler = function update(/* dt */) {\n    var i;\n    var mesh;\n    if (meshes.length) {\n        view.notifyChange(view.camera.camera3D, true);\n    }\n    for (i = 0; i < meshes.length; i++) {\n        mesh = meshes[i];\n        if (mesh) {\n            mesh.scale.z = Math.min(\n                1.0, mesh.scale.z + 0.1);\n            mesh.updateMatrixWorld(true);\n        }\n    }\n    meshes = meshes.filter(function filter(m) { return m.scale.z < 1; });\n};\n\nview.addFrameRequester(itowns.MAIN_LOOP_EVENTS.BEFORE_RENDER, scaler);\n\nvar wfsBuildingSource = new itowns.WFSSource({\n    url: 'https://wxs.ign.fr/topographie/geoportail/wfs?',\n    version: '2.0.0',\n    typeName: 'BDTOPO_V3:batiment',\n    crs: 'EPSG:4326',\n    ipr: 'IGN',\n    format: 'application/json',\n    extent: {\n        west: 4.568,\n        east: 5.18,\n        south: 45.437,\n        north: 46.03,\n    },\n});\n\nvar wfsBuildingLayer = new itowns.FeatureGeometryLayer('WFS Building', {\n    batchId: function (property, featureId) { return featureId; },\n    onMeshCreated: function scaleZ(mesh) {\n        mesh.children.forEach(c => {\n            c.scale.z = 0.01;\n            meshes.push(c);\n        })\n    },\n    filter: acceptFeature,\n    source: wfsBuildingSource,\n    zoom: { min: 14 },\n\n    style: new itowns.Style({\n        fill: {\n            color: colorBuildings,\n            base_altitude: altitudeBuildings,\n            extrusion_height: extrudeBuildings,\n        }\n    })\n});\nview.addLayer(wfsBuildingLayer);\n\nvar menuGlobe = new GuiTools('menuDiv', view);\n// Listen for globe full initialisation event\nview.addEventListener(itowns.GLOBE_VIEW_EVENTS.GLOBE_INITIALIZED, function () {\n    // eslint-disable-next-line no-console\n    console.info('Globe initialized');\n});\n\ndebug.createTileDebugUI(menuGlobe.gui, view);\n\nfunction picking(event) {\n    if (view.controls.isPaused) {\n        var htmlInfo = document.getElementById('info');\n        var intersects = view.pickObjectsAt(event, 3, 'WFS Building');\n        var properties;\n        var info;\n        var batchId;\n\n        htmlInfo.innerHTML = ' ';\n\n        if (intersects.length) {\n            batchId = intersects[0].object.geometry.attributes.batchId.array[intersects[0].face.a];\n            properties = intersects[0].object.feature.geometries[batchId].properties;\n\n            Object.keys(properties).map(function (objectKey) {\n                var value = properties[objectKey];\n                if (value) {\n                    var key = objectKey.toString();\n                    if (key[0] !== '_' && key !== 'geometry_name') {\n                        info = value.toString();\n                        htmlInfo.innerHTML += '<li><b>' + key + ': </b>' + info + '</li>';\n                    }\n                }\n            });\n        }\n    }\n}\n\nfor (var layer of view.getLayers()) {\n    if (layer.id === 'WFS Bus lines') {\n        layer.whenReady.then(function _(layer) {\n            var gui = debug.GeometryDebug.createGeometryDebugUI(menuGlobe.gui, view, layer);\n            debug.GeometryDebug.addMaterialLineWidth(gui, view, layer, 1, 10);\n        });\n    }\n    if (layer.id === 'WFS Building') {\n        layer.whenReady.then(function _(layer) {\n            var gui = debug.GeometryDebug.createGeometryDebugUI(menuGlobe.gui, view, layer);\n            debug.GeometryDebug.addWireFrameCheckbox(gui, view, layer);\n            window.addEventListener('mousemove', picking, false);\n        });\n    }\n    if (layer.id === 'WFS Route points') {\n        layer.whenReady.then(function _(layer) {\n            var gui = debug.GeometryDebug.createGeometryDebugUI(menuGlobe.gui, view, layer);\n            debug.GeometryDebug.addMaterialSize(gui, view, layer, 1, 200);\n        });\n    }\n}"],"names":[],"version":3,"file":"index.de158e3a.js.map","sourceRoot":"/__parcel_source_root/"}